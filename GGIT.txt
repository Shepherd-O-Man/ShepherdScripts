--@name GGit
--@author Cosmiverse
--@shared

--This is a script to get scripts on Github
--Handy huh?

--HOW TO USE
--Enter your repo below like this -> Username/Reponame
--To get a script use "!ggit get" to display a list of files within the repo.
--This should return both folders and files. (Files haing .txt, .md, etc)
--To get the code do "!ggit download [file path]". EXAMPLE: "Test/Text.txt"
--Refresh starfall and rename the outputted file located in Data Files


--YOUR REPO
local REPO = "Shepherd-O-Man/StarFallScripts"
local LINK = "https://api.github.com/repos/"..REPO.."/contents/"


--CommandHandler
hook.add("PlayerChat", "Command", function(ply,text)
    if ply == owner() then
        local E = string.explode(" ",text)
        if text == "!ggit get" then
            if http.canRequest() then
                http.get(LINK, function(content)
                    local T = json.decode(content)
                    print(table.count(T))
                    for x = 1,table.count(T),1 do
                        print(T[x]["name"])
                    end
                end,
                function()
                    print("Error 002: Cannot access URL!")
                end)
            else
                print("Error 001: Cannot request!")
            end
        end
        if E[1] == "!ggit" and E[2] == "download" then
            if E[3] != nil then
                if http.canRequest() then
                    http.get("https://raw.githubusercontent.com/"..REPO.."/master/"..E[3], function(content)
                        print("Writing file...")
                        file.write("output.txt",content)
                        print("Done!")
                    end,
                    function()
                        print("Error 002: Cannot access URL!")
                    end)
                else
                    print("Error 001: Cannot request!")
                end
            else
                print("Error 003: Cannot locate file argument")
            end
        end
    end
end)